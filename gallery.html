<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Gallery - Bonghomestay.com</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-image: url('https://jdsziypwwtysgwvabsyp.supabase.co/storage/v1/object/public/room-images/background/123.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            color: #fff;
        }
        .container {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
        }
        h1, h3 {
            color: #fff;
        }
        #hotelList a {
            font-weight: bold;
            display: block;
            margin: 10px 0;
            cursor: pointer;
            color: #fff;
        }
        #hotelList a:hover {
            color: #007bff;
        }
        #photoViewer {
            margin-top: 20px;
        }
        #photoDisplay {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        #enlargedPhoto {
            max-width: 500px;
            max-height: 400px;
            border-radius: 8px;
        }
        #prevPhoto, #nextPhoto {
            font-size: 24px;
            padding: 10px;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            color: #fff;
            margin: 0 10px;
        }
        #photoThumbnails img {
            width: 100px;
            height: 100px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            opacity: 0.8;
        }
        #photoThumbnails img:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Room Gallery</h1>
        <div class="text-center mb-4">
            <a href="index.html" class="btn btn-primary">Back to Home</a>
        </div>
        <div id="hotelList"></div>
        <div id="photoViewer" style="display: none;">
            <button id="backToGallery" class="btn btn-secondary mb-3">Back to Gallery</button>
            <div id="photoDisplay">
                <button id="prevPhoto" style="display: none;">←</button>
                <img id="enlargedPhoto" src="" alt="Hotel Photo">
                <button id="nextPhoto" style="display: none;">→</button>
            </div>
            <div id="photoThumbnails"></div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const hotelList = document.getElementById("hotelList");
            const photoViewer = document.getElementById("photoViewer");
            const photoThumbnails = document.getElementById("photoThumbnails");
            const enlargedPhoto = document.getElementById("enlargedPhoto");
            const prevPhoto = document.getElementById("prevPhoto");
            const nextPhoto = document.getElementById("nextPhoto");

            try {
                const response = await fetch("https://hotel-backend-n0n6.onrender.com/rooms");
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const rooms = await response.json();
                console.log("Rooms fetched for gallery:", rooms);

                // Group rooms by hotel
                const hotels = {};
                rooms.forEach(room => {
                    if (!hotels[room.hotel_name]) {
                        hotels[room.hotel_name] = [];
                    }
                    if (room.image) {
                        hotels[room.hotel_name].push(room.image);
                    }
                });

                // Display hotel list
                hotelList.innerHTML = "";
                Object.keys(hotels).sort().forEach(hotel => {
                    const hotelLink = document.createElement("a");
                    hotelLink.href = "#";
                    hotelLink.textContent = hotel;
                    hotelLink.addEventListener("click", (e) => {
                        e.preventDefault();
                        showHotelPhotos(hotel, hotels[hotel]);
                    });
                    hotelList.appendChild(hotelLink);
                });
            } catch (error) {
                console.error("Error fetching rooms for gallery:", error);
                hotelList.innerHTML = "<p>Error loading hotels. Please try again later.</p>";
            }

            function showHotelPhotos(hotel, photos) {
                // Hide hotel list and show photo viewer
                hotelList.style.display = "none";
                photoViewer.style.display = "block";

                // Display thumbnails
                photoThumbnails.innerHTML = "";
                photos.forEach(photo => {
                    const thumbnail = document.createElement("img");
                    thumbnail.src = photo;
                    thumbnail.addEventListener("click", () => {
                        enlargedPhoto.src = photo;
                        updateNavigationButtons(photos, photos.indexOf(photo));
                    });
                    photoThumbnails.appendChild(thumbnail);
                });

                // Show the first photo by default
                if (photos.length > 0) {
                    enlargedPhoto.src = photos[0];
                    updateNavigationButtons(photos, 0);
                }

                // Navigation buttons
                prevPhoto.onclick = () => {
                    const currentIndex = photos.indexOf(enlargedPhoto.src);
                    const newIndex = (currentIndex - 1 + photos.length) % photos.length;
                    enlargedPhoto.src = photos[newIndex];
                    updateNavigationButtons(photos, newIndex);
                };

                nextPhoto.onclick = () => {
                    const currentIndex = photos.indexOf(enlargedPhoto.src);
                    const newIndex = (currentIndex + 1) % photos.length;
                    enlargedPhoto.src = photos[newIndex];
                    updateNavigationButtons(photos, newIndex);
                };

                // Back button
                document.getElementById("backToGallery").onclick = () => {
                    hotelList.style.display = "block";
                    photoViewer.style.display = "none";
                };
            }

            function updateNavigationButtons(photos, currentIndex) {
                prevPhoto.style.display = photos.length > 1 ? "block" : "none";
                nextPhoto.style.display = photos.length > 1 ? "block" : "none";
            }
        });
    </script>
</body>
</html>